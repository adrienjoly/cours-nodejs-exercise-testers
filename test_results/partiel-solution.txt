
Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from partiel-solution...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ 'use strict';

      const { PORT, MONGODB_URL, MONGODB_DATABASE, MONGODB_COLLECTION } = process.env;

      const express = require('express');
      const app = express();

      const MongoClient = require('mongodb').MongoClient;

      async function getLastVistor() {
        const client = new MongoClient(MONGODB_URL);
        await client.connect();
        const db = client.db(MONGODB_DATABASE);
        const col = db.collection(MONGODB_COLLECTION);
        const doc = await col.findOne();
        client.close();
        return doc;
      }

      async function storeVisitor(nom) {
        const client = new MongoClient(MONGODB_URL);
        await client.connect();
        const db = client.db(MONGODB_DATABASE);
        const col = db.collection(MONGODB_COLLECTION);
        await col.deleteMany({});
        await col.insertOne({ nom });
        client.close();
      }

      app.use(express.urlencoded()); // pour dÃ©coder les donnÃ©es URL-encodÃ©es des requÃªtes

      app.post('/', async (req, res) => {
        const { nom } = req.body;
        if (nom) await storeVisitor(nom);
        res.send(nom ? `Bienvenue, ${nom}.` : 'Il manque votre nom.');
      });

      app.get('/', async (req, res) => {
        try {
          const { nom } = (await getLastVistor()) || {};
          res.send(
            nom
              ? `La dernieÌ€re personne que j'ai rencontreÌe est: ${nom}.`
              : `Je n'ai rencontreÌ personne pour l'instant`
          );
        } catch (err) {
          res.send(`J'ai perdu la meÌmoire...`);
        }
      });

      app.listen(PORT, function() {
        console.log('The server is listening on port', PORT);
      });

  âœ” server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ” package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install
  âœ” package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start
  âœ” README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur
  âœ” (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/
  âœ” (2) POST / {} -> /Il manque votre nom/
  âœ” (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/
  âœ” (4) POST / "nom=adrien" -> /Bienvenue, adrien/
  âœ” (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/
  âœ” (6) POST / "nom=michelle" -> /Bienvenue, michelle/
  âœ” (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/
  âœ” MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur
  âœ” (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus
  â”€

  14 tests passed

ğŸ§¹ Stop and remove Docker containers...
