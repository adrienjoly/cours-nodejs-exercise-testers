
Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./student-code/...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ const express = require('express')
      const app = express()
      const bodyParser = require('body-parser')
      const MongoClient = require('mongodb').MongoClient;

      process.env['port'] = "3000";
      process.env['MANGODB_URL'] = "mongodb+srv://chatbot:chatbot@firstclassapi-fummx.azure.mongodb.net/partielnode?retryWrites=true&w=majority"
      process.env['MANGODB_DATABASE'] = "partiel-node"
      process.env['MANGODB_COLLECTION'] = "names"


      const client = new MongoClient(process.env.MONGODB_URL, { useNewUrlParser: true, useUnifiedTopology: true });


      (async () => {
          try {

              await client.connect();
              const db = client.db(process.env.MONGODB_DATABASE);
              const callName = db.collection(process.env.MONGODB_COLLECTION)

              app.use(bodyParser.urlencoded({
                  extended: true
              }));

              app.get('/', async function (req, res) {
                  const name = await callName.find({}).toArray();
                  res.send('Hello World!')
              })

              app.post('/', async function (req, res) {
                  if (req.body.nom === undefined) {
                      res.send('Il manque votre nom.')
                  } else {
                      const addName = await callName.insertOne({ nom: req.body.nom })
                      res.send('Bienvenue, ' + req.body.nom + '.')
                  }
              })

              app.listen(process.even.PORT, function () {
                  console.log('Le serveur fonctionne sur le port ' + process.env.PORT)
              })

          } catch (err) {

          }
      })()
  âœ” server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ” package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install
  âœ” package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start
  âœ– README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur 
  âœ– le serveur rÃ©pond sur le port 3000 Rejected promise returned by test
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (2) POST / {} -> /Il manque votre nom/ 
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ 
  âœ– (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ 
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus 

  11 tests failed

  README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:107

   106:     const readme = await runInDocker('cat README.md');
   107:     t.regex(readme, /npm i/);                         
   108:     t.regex(readme, /node server|npm start/);         

  Value must match expression:

  `# Application testsââŠ
  ââŠ
  $ curl http://localhost:3000/ââŠ
  $ curl -X POST --header "Content-Type: application/x-www-form-urlencoded" --data "nom=VotrePrÃ©nom" http://localhost:3000/ââŠ
  ââŠ
  # InstallationââŠ
  ââŠ
  cd 1157-Node.jsââŠ
  Npm initââŠ
  Npm startââŠ
  node server.jsââŠ
  ââŠ
  `

  Regular expression:

  /npm i/



  le serveur rÃ©pond sur le port 3000


  Rejected promise returned by test. Reason:

  Error {
    cmd: 'PORT=3000 ./wait-for-student-server.sh',
    code: 1,
    killed: false,
    signal: null,
    stderr: '',
    stdout: `âŠ
    Wait for server on port 3000...âŠ
    (1)âŠ
    (2)âŠ
    (3)âŠ
    âŒ  Server is NOT listening on port 3000.âŠ
    `,
    message: `Command failed: PORT=3000 ./wait-for-student-server.shâŠ
    `,
  }



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/



  (2) POST / {} -> /Il manque votre nom/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Il manque votre nom/



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, adrien/



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, michelle/



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:162

   161:       const { data } = await axios[method.toLowerCase()](url, body);
   162:       t.regex(data, exp);                                           
   163:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:183

   182:     );                                                       
   183:     t.is(docs.length, 1);                                    
   184:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:194

   193:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   194:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   195:   }                                                                     

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /J'ai perdu la meÌmoire/


ğŸ§¹ Stop and remove Docker containers...
