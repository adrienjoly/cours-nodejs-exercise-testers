
Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./student-code/...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ let http = require('http')

      http.createServer(

      server.on('request', (request, response) => {
   

          response.end('nom')
      }))

      server.listen(80)
  âœ– server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises 
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ– package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install Rejected promise returned by test
  âœ– package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start Rejected promise returned by test
  âœ– README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur Rejected promise returned by test
{ Error: Command failed: docker exec my-running-app sh -c "npm install --no-audit"
npm ERR! code EJSONPARSE
npm ERR! file /usr/src/app/package.json
npm ERR! JSON.parse Failed to parse json
npm ERR! JSON.parse Unexpected end of JSON input while parsing near ''
npm ERR! JSON.parse Failed to parse package.json data.
npm ERR! JSON.parse package.json must be actual JSON, not just JavaScript.

npm ERR! A complete log of this run can be found in:
npm ERR!     /root/.npm/_logs/2020-07-18T08_41_51_557Z-debug.log

    at ChildProcess.exithandler (child_process.js:294:12)
    at ChildProcess.emit (events.js:198:13)
    at maybeClose (internal/child_process.js:982:16)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:259:5)
  killed: false,
  code: 1,
  signal: null,
  cmd: 'docker exec my-running-app sh -c "npm install --no-audit"',
  stdout: '',
  stderr:
   'npm ERR! code EJSONPARSE\nnpm ERR! file /usr/src/app/package.json\nnpm ERR! JSON.parse Failed to parse json\nnpm ERR! JSON.parse Unexpected end of JSON input while parsing near \'\'\nnpm ERR! JSON.parse Failed to parse package.json data.\nnpm ERR! JSON.parse package.json must be actual JSON, not just JavaScript.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR!     /root/.npm/_logs/2020-07-18T08_41_51_557Z-debug.log\n' }
/usr/src/app/server.js:5
server.on('request', (request, response) => {
^
ReferenceError: server is not defined
/usr/src/app/server.js:5
server.on('request', (request, response) => {
^

ReferenceError: server is not defined
    at Object.<anonymous> (/usr/src/app/server.js:5:1)
    at Module._compile (internal/modules/cjs/loader.js:778:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:789:10)
    at Module.load (internal/modules/cjs/loader.js:653:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)
    at Function.Module._load (internal/modules/cjs/loader.js:585:3)
    at Function.Module.runMain (internal/modules/cjs/loader.js:831:12)
    at startup (internal/bootstrap/node.js:283:19)
    at bootstrapNodeJSCore (internal/bootstrap/node.js:623:3)

[SERVER STARTER] âŒ Error: runInDockerBg process exited with 1
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (2) POST / {} -> /Il manque votre nom/ 
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ 
  âœ– (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ 
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus 

  13 tests failed

  server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:84

   83:     const { serverSource } = t.context;  
   84:     t.regex(serverSource, /await/);      
   85:     t.notRegex(serverSource, /\.then\(/);

  Value must match expression:

  `let http = require('http')âŠ
  âŠ
  http.createServer(âŠ
  âŠ
  server.on('request', (request, response) => {âŠ
     âŠ
  âŠ
      response.end('nom')âŠ
  }))âŠ
  âŠ
  server.listen(80)`

  Regular expression:

  /await/



  package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:103

   102:   async t => {                                                          
   103:     const { dependencies } = JSON.parse(await runInDocker('cat package.â€¦
   104:     const deps = Object.keys(dependencies);                             

  Rejected promise returned by test. Reason:

  SyntaxError {
    message: 'Unexpected end of JSON input',
  }



  package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:113

   112:   async t => {                                                          
   113:     const { scripts } = JSON.parse(await runInDocker('cat package.json'â€¦
   114:     t.regex(scripts.start, /node server.js/);                           

  Rejected promise returned by test. Reason:

  SyntaxError {
    message: 'Unexpected end of JSON input',
  }



  README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur


  Rejected promise returned by test. Reason:

  Error {
    cmd: 'docker exec my-running-app sh -c "cat README.md"',
    code: 1,
    killed: false,
    signal: null,
    stderr: `cat: README.md: No such file or directoryâŠ
    `,
    stdout: '',
    message: `Command failed: docker exec my-running-app sh -c "cat README.md"âŠ
    cat: README.md: No such file or directoryâŠ
    `,
  }



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/



  (2) POST / {} -> /Il manque votre nom/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Il manque votre nom/



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, adrien/



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, michelle/



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:172

   171:       const { data } = await axios[method.toLowerCase()](url, body);
   172:       t.regex(data, exp);                                           
   173:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:194

   193:     );                                                       
   194:     t.is(docs.length, 1);                                    
   195:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:206

   205:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   206:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   207:   }                                                                     

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /J'ai perdu la meÌmoire/


ğŸ§¹ Stop and remove Docker containers...
