Remarques:
- les variables d'environnement demandÃ©es pour mongodb ont Ã©tÃ© ignorÃ©es.
- confusion dans la logique: insertion db dans endpoint GET au lieu de POST.
- incomprÃ©hension sur la structure des documents mongodb: usage d'un attribut `from` non demandÃ©.
- je ne vois pas l'intÃ©rÃªt de diviser le code dans deux fonctions anonymes auto-appelantes.

Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./submissions/1155-node...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ const PORT = process.env.PORT || 3000;
      const fs = require("fs");
      const express = require("express");
      const app = express();
      const MongoClient = require('mongodb').MongoClient;
      const uri = process.env.MONGODB_URI || "mongodb+srv://chloe:ecologie@cluster0-ljllu.mongodb.net/test?retryWrites=true&w=majority";


      (async function () {
          try {
              const client = new MongoClient(uri, {
                  useNewUrlParser: true
              });
              await client.connect();
              const data = client.db("nodejs_mongo");
              collection = data.collection("nom");
          } catch (err) {
              console.log(err.stack);
          }

      })();


      (async () => {
          app.get('/', async function (req, res) {

              const namebdd = await collection.find({
                  from: nom
              }).sort({
                  _id: -1
              }).limit(1).toArray();
              if (namebdd) {
                  res.send('La derniÃ¨re personne que j\'ai rencontrÃ©e est: ' + namebdd + '.')
              } else if (namebdd === "") {
                  res.send('Je n\'ai rencontrÃ© personne pour l\'instant')
              } else {
                  res.send('J\'ai perdu la mÃ©moire...')
              }

              await collection.insertOne({
                  from: 'nom',
                  msg: req.query.msg
              });
          });


          app.post('/', function (req, res) {
              if (req.body.nom != undefined) {
                  res.send('Bienvenue, ' + req.body.nom + '.')
              } else {
                  res.send('Il manque votre nom.')
              }
          })



          app.listen(PORT, function () {
              console.log("The server is listening on port", PORT);
          });

      });
  âœ” server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ” package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install
  âœ” package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start
  âœ– README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur 
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (2) POST / {} -> /Il manque votre nom/ 
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ 
  âœ– (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ 
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus 
  â”€

  README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur

  test-partiel.js:119

   118:     t.regex(readme, /node server|npm start/);
   119:     t.regex(readme, /npm test|curl/);        
   120:   }                                          

  Value must match expression:

  `setupâŠ
  git clone https://gitlab.eemi.tech/chloe.guerin/nodejs_chatbot.gitâŠ
  npm installâŠ
  npm startâŠ
  âŠ
  pour acceder par la suite sur le navigateur:  http://localhost:3000/`

  Regular expression:

  /npm test|curl/

  â€º test-partiel.js:119:7



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/

  â€º test-partiel.js:167:9



  (2) POST / {} -> /Il manque votre nom/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Il manque votre nom/

  â€º test-partiel.js:167:9



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/

  â€º test-partiel.js:167:9



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, adrien/

  â€º test-partiel.js:167:9



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  â€º test-partiel.js:167:9



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, michelle/

  â€º test-partiel.js:167:9



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  â€º test-partiel.js:167:9



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  test-partiel.js:188

   187:     );                                                       
   188:     t.is(docs.length, 1);                                    
   189:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1

  â€º test-partiel.js:188:7



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  test-partiel.js:200

   199:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   200:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   201:   }                                                                     

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /J'ai perdu la meÌmoire/

  â€º test-partiel.js:200:7

  â”€

  10 tests failed

ğŸ§¹ Stop and remove Docker containers...
