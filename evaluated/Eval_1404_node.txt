Commentaires:
- l'URL, le nom et la collection de la db auraient du Ãªtre rÃ©cupÃ©rÃ©es depuis les variables d'environnement demandÃ©es.
- usage d'une fonction de callback au lieu de async/await.
- les routes/endpoints ne correspondent pas Ã  ce qui Ã©tait demandÃ©.
- le code n'effectue ni lecture ni ajout dans mongodb.

Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./student-code/...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ const express = require('express');
      const app = express();
      const bodyParser = require('body-parser');
      const MongoClient = require('mongodb').MongoClient;
      const assert = require('assert');

      // Connection URL
      const url = 'mongodb+srv://Partiel1404:bobrasovki@chatbot-ifzz3.azure.mongodb.net/test';

      // Database Name
      const dbName = 'partiel';

      // Use connect method to connect to the server
      MongoClient.connect(url, function(err, client) {
        assert.equal(null, err);
        console.log("Connected successfully to server");

        const db = client.db(dbName);

        client.close();
      });
      //mon code
      app.use(bodyParser.json());
      app.use(express.urlencoded({ extended: true }))

      app.get('/', function (request, response) {
          response.send('Hello World');

      });

      app.get('/nom', function (request, response) {
          if (request.query.nom === undefined) {
              response.send('Quel est votre nom ?')
          } else {
              response.send('Bienvenue, ' + request.query.nom + '.')
          }
      });

      app.listen(3000, function () {
          console.log("Server running at http://localhost:3000");
      });

      //Il me reste peu de temps pour finir, il faut que je fasse en sorte avec une variable env d'envoyer le nom dans une bdd mongodb pour ensuite
      //la recuperer quand la variable "nom" est identique Ã  celle sur mongodb
  âœ– server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises 
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ” package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install
  âœ” package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start
  âœ– README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur 
/usr/src/app/node_modules/mongodb/lib/utils.js:725
          throw error;
Server running at http://localhost:3000

(node) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.

/usr/src/app/node_modules/mongodb/lib/utils.js:725
          throw error;
          ^

AssertionError [ERR_ASSERTION]: null == { MongoNetworkError: failed to connect to server [chatbot-shard-00-02-ifzz3.azure.mongodb.net:27017] on first connect [MongoN...
    at /usr/src/app/server.js:15:10
    at /usr/src/app/node_modules/mongodb/lib/utils.js:722:9
    at err (/usr/src/app/node_modules/mongodb/lib/mongo_client.js:223:23)
    at connectCallback (/usr/src/app/node_modules/mongodb/lib/operations/connect.js:361:5)
    at topology.connect.err (/usr/src/app/node_modules/mongodb/lib/operations/connect.js:594:14)
    at ReplSet.<anonymous> (/usr/src/app/node_modules/mongodb/lib/topologies/replset.js:357:11)
    at Object.onceWrapper (events.js:286:20)
    at ReplSet.emit (events.js:198:13)
    at /usr/src/app/node_modules/mongodb/lib/core/topologies/replset.js:619:23
    at done (/usr/src/app/node_modules/mongodb/lib/core/topologies/replset.js:290:7)

[SERVER STARTER] âŒ Error: runInDockerBg process exited with 1
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (2) POST / {} -> /Il manque votre nom/ 
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ 
  âœ– (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ 
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur Rejected promise returned by test
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus Rejected promise returned by test
  â”€

  server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises

  test-partiel.js:79

   78:     const { serverSource } = t.context;  
   79:     t.regex(serverSource, /await/);      
   80:     t.notRegex(serverSource, /\.then\(/);

  Value must match expression:

  `const express = require('express');âŠ
  const app = express();âŠ
  const bodyParser = require('body-parser');âŠ
  const MongoClient = require('mongodb').MongoClient;âŠ
  const assert = require('assert');âŠ
  âŠ
  // Connection URLâŠ
  const url = 'mongodb+srv://Partiel1404:bobrasovki@chatbot-ifzz3.azure.mongodb.net/test';âŠ
  âŠ
  // Database NameâŠ
  const dbName = 'partiel';âŠ
  âŠ
  // Use connect method to connect to the serverâŠ
  MongoClient.connect(url, function(err, client) {âŠ
    assert.equal(null, err);âŠ
    console.log("Connected successfully to server");âŠ
  âŠ
    const db = client.db(dbName);âŠ
  âŠ
    client.close();âŠ
  });âŠ
  //mon codeâŠ
  app.use(bodyParser.json());âŠ
  app.use(express.urlencoded({ extended: true }))âŠ
  âŠ
  app.get('/', function (request, response) {âŠ
      response.send('Hello World');âŠ
  âŠ
  });âŠ
  âŠ
  app.get('/nom', function (request, response) {âŠ
      if (request.query.nom === undefined) {âŠ
          response.send('Quel est votre nom ?')âŠ
      } else {âŠ
          response.send('Bienvenue, ' + request.query.nom + '.')âŠ
      }âŠ
  });âŠ
  âŠ
  app.listen(3000, function () {âŠ
      console.log("Server running at http://localhost:3000");âŠ
  });âŠ
  âŠ
  //Il me reste peu de temps pour finir, il faut que je fasse en sorte avec une variable env d'envoyer le nom dans une bdd mongodb pour ensuiteâŠ
  //la recuperer quand la variable "nom" est identique Ã  celle sur mongodb`

  Regular expression:

  /await/

  â€º test.serial.t (test-partiel.js:79:7)



  README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur

  test-partiel.js:119

   118:     t.regex(readme, /node server|npm start/);
   119:     t.regex(readme, /npm test|curl/);        
   120:   }                                          

  Value must match expression:

  `PartielââŠ
  ââŠ
  Pour tester mon code il faut faire une npm install puis un npm startââŠ
  Ce connecter sur le port 3000ââŠ
  taper "nom?nom=nomquevousvoulez" dans l'URL et il vous repondra bienvenue`

  Regular expression:

  /npm test|curl/

  â€º test.serial (test-partiel.js:119:7)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (2) POST / {} -> /Il manque votre nom/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Il manque votre nom/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, adrien/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, michelle/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  test-partiel.js:188

   187:     );                                                                  
   188:     t.is(docs.length, 1);                                    
   189:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1

  â€º test-partiel.js:188:7



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  test-partiel.js:200

   199:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   200:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   201:   }                                                                     

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /J'ai perdu la meÌmoire/

  â€º test-partiel.js:200:7

  â”€

  11 tests failed

ğŸ§¹ Stop and remove Docker containers...
