Remarques:
- le code est lisible et montre une bonne maitrise.
- la collection ne respecte pas celle qui était demandée, à cause de l'usage de mongoose avec le nom "User".
- la collection ne doit jamais contenir plus d'un document.

Stop and remove previous Docker containers...

🐳 Generate and run Dockerfile from ./student-code/...

👾 Run test suite against container...

    Lecture du code source fourni
    ℹ // import des dépendance
      const express = require('express');
      const bodyParser = require('body-parser');
      const mongoose  = require('mongoose');
      const { MongoClient } = require('mongodb');
      const options = { server: { socketOptions: { keepAlive: 300000, connectTimeoutMS: 30000 } }, 
          replset: { socketOptions: { keepAlive: 300000, connectTimeoutMS : 30000 } } };

      // config constante
      const port = process.env.port || 3000,
          MONGODB_COLLECTION = process.env.MONGODB_COLLECTION || 'user',
          MONGODB_DATABASE = process.env.MONGODB_DATABASE || 'apiNom',
          MONGODB_URL = process.env.MONGODB_URL || 'mongodb://localhost:27017/apiNom';

      // init mongodb
      const client = new MongoClient(MONGODB_URL);
      mongoose.connect(MONGODB_URL, options);

      // create du schema user
      const userSchema = mongoose.Schema({
          nom: String
      })
      const User = mongoose.model('User', userSchema)

      // config express
      const app = express();

      app.use(bodyParser.urlencoded({extended: true}))

      app.get('/', async (req, res) => {
          try {
              const lastUser = await User.findOne().sort({ field: 'asc', _id: -1 }).limit(1)
              if (lastUser) {
                  res.send("La dernière personne que j'ai rencontrée est: " + lastUser.nom + ".");
              } else {
                  res.send("Je n'ai rencontré personne pour l'instant")
              }
          } catch (err) {
              res.send("J'ai perdu la mémoire...");
          }
      })

      app.post('/', (req, res) => {
          console.log(MONGODB_URL)
          if (req.body.nom) {
              const user = new User();
              user.nom = req.body.nom;
              user.save();
              res.send("Bienvenue, " + user.nom + '.');
          } else {
              res.send('Il manque votre nom.')
          }
      })

      // lance le serv
      app.listen(port, () => {
          console.log('app listen on http://localhost:' + port)
      })
  ✔ server.js utilise seulement await pour récupérer les valeurs promises
  ✔ server.js contient l'intégralité du code source de votre programme
  ✖ package.json permet d'installer les dépendances nécessaires à l'aide de npm install 
  ✔ package.json permet de démarrer le serveur à l'aide de npm start
  ✔ README.md inclue les instructions à suivre pour installer, exécuter et tester le serveur
[MONGODB SERVER] [ERROR] mongodb-fs.processor - [39mUncaught exception processing socket data:  TypeError: Cannot read property 'users' of undefined
  ✖ (1) GET / {} -> /Je n'ai rencontré personne pour l'instant/ 
  ✔ (2) POST / {} -> /Il manque votre nom/
[MONGODB SERVER] [ERROR] mongodb-fs.processor - [39mUncaught exception processing socket data:  TypeError: Cannot read property 'users' of undefined
  ✖ (3) GET / {} -> /Je n'ai rencontré personne pour l'instant/ 
  ✔ (4) POST / "nom=adrien" -> /Bienvenue, adrien/
[MONGODB SERVER] [ERROR] mongodb-fs.processor - [39mUncaught exception processing socket data:  TypeError: Cannot read property 'users' of undefined
[MONGODB SERVER] [ERROR] mongodb-fs.processor - [39mUncaught exception processing socket data:  TypeError: Cannot read property 'users' of undefined
  ✖ (5) GET / {} -> /La dernière personne que j'ai rencontrée est: adrien/ 
  ✔ (6) POST / "nom=michelle" -> /Bienvenue, michelle/
[MONGODB SERVER] [ERROR] mongodb-fs.processor - [39mUncaught exception processing socket data:  TypeError: Cannot read property 'users' of undefined
[MONGODB SERVER] [ERROR] mongodb-fs.processor - [39mUncaught exception processing socket data:  Error: Operation not supported: 1638521
  ✖ (7) GET / {} -> /La dernière personne que j'ai rencontrée est: michelle/ 
  ✖ MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
(node) UnhandledPromiseRejectionWarning: MongoNetworkError: connection 4 to localhost:27027 closed
  ✖ (8) GET / -> "J'ai perdu la mémoire...", si la db ne fonctionne plus 
  ─

  package.json permet d'installer les dépendances nécessaires à l'aide de npm install

  test-partiel.js:101

   100:     t.true(deps.includes('express'));
   101:     t.true(deps.includes('mongodb'));
   102:   }                                  

  Value is not `true`:

  false

  › test.serial (test-partiel.js:101:11)
  › process._tickCallback (internal/process/next_tick.js:68:7)



  (1) GET / {} -> /Je n'ai rencontré personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '❌ HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /Je n'ai rencontré personne pour l'instant/

  › test.serial (test-partiel.js:167:9)
  › process._tickCallback (internal/process/next_tick.js:68:7)



  (3) GET / {} -> /Je n'ai rencontré personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '❌ HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /Je n'ai rencontré personne pour l'instant/

  › test.serial (test-partiel.js:167:9)
  › process._tickCallback (internal/process/next_tick.js:68:7)



  (5) GET / {} -> /La dernière personne que j'ai rencontrée est: adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '❌ HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /La dernière personne que j'ai rencontrée est: adrien/

  › test.serial (test-partiel.js:167:9)
  › process._tickCallback (internal/process/next_tick.js:68:7)



  (7) GET / {} -> /La dernière personne que j'ai rencontrée est: michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '❌ HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /La dernière personne que j'ai rencontrée est: michelle/

  › test.serial (test-partiel.js:167:9)
  › process._tickCallback (internal/process/next_tick.js:68:7)



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  test-partiel.js:188

   187:     );                                                       
   188:     t.is(docs.length, 1);                                    
   189:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1

  › test.serial (test-partiel.js:188:7)
  › process._tickCallback (internal/process/next_tick.js:68:7)



  (8) GET / -> "J'ai perdu la mémoire...", si la db ne fonctionne plus

  test-partiel.js:200

   199:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/…
   200:     t.regex(data, /J'ai perdu la mémoire/);                            
   201:   }                                                                     

  Value must match expression:

  '❌ HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /J'ai perdu la mémoire/

  › test.serial (test-partiel.js:200:7)
  › process._tickCallback (internal/process/next_tick.js:68:7)

  ─

  7 tests failed

🧹 Stop and remove Docker containers...
