Commentaires:
- la fonction async anonyme n'est jamais appelÃ©e => le code ne peut pas s'exÃ©cuter.
- usage de await dans une fonction non async
- problÃ¨me de connexion db: l'URL doit Ãªtre fournie avant l'appel Ã  connect()
- les variables MONGODB_* ne sont pas dÃ©finies, elles devaient Ãªtre rÃ©cupÃ©rÃ©es depuis process.env.
- il manque l'enregistrement du nom en db.
- il manque une reponse dans le cas oÃ¹ GET / Ã©choue.

Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./student-code/...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ const express = require('express')
      const app = express()
      const name = ''
      const PORT = process.env.PORT || 3000;

      const MongoClient = require("mongodb").MongoClient;

      app.use(bodyParser.urlencoded({
          extended: true
      }))

      // Fonctions MongoDB asynchrones
      async () => {
          await client.connect();
          const database = client.db(MONGODB_DATABASE)
          const client = new MongoClient(MONGODB_URL);
          const collection = db.collection(MONGODB_COLLECTION);

      // Route post '/'
      app.post("/", function (req, res) {
          try {
              const lastName = await collection.findOne().sort({
                  field: 'asc',
                  _id: -1
              }).limit(1)

              if (lastName) {
                  res.send("Bienvenue, " + lastName);
              } else {
                  res.send("Il manque votre nom.");
              }
          } catch (err) {
              console.log(err)
          }
      });

      // Route get '/'
      app.get('/', function (req, res) {
          try {
              const lastPerson = await collection.findOne().sort({
                  field: 'asc',
                  _id: -1
              }).limit(1)
              if (lastPerson) {
                  res.send("La derniÃ¨re personne que j'ai rencontrÃ©e est: " + lastPerson)
              } else {
                  res.send("Je n'ai rencontrÃ© personne pour l'instant")
              }
          } catch (err) {
              res.send("J'ai perdu la mÃ©moire...")
          }
      })

      }

      // Port utilisÃ© par le serveur
      app.listen(PORT, function () {
          console.log("The server is listening on port", PORT);
      });
  âœ” server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ” package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install
  âœ– package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start `t.regex()` must be called with a string
  âœ– README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur Rejected promise returned by test
/usr/src/app/server.js:22
        const lastName = await collection.findOne().sort({
                         ^^^^^
SyntaxError: await is only valid in async function
/usr/src/app/server.js:22
        const lastName = await collection.findOne().sort({
                         ^^^^^

SyntaxError: await is only valid in async function
    at Module._compile (internal/modules/cjs/loader.js:723:23)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:789:10)
    at Module.load (internal/modules/cjs/loader.js:653:32)
    at tryModuleLoad (internal/modules/cjs/loader.js:593:12)
    at Function.Module._load (internal/modules/cjs/loader.js:585:3)
    at Function.Module.runMain (internal/modules/cjs/loader.js:831:12)
    at startup (internal/bootstrap/node.js:283:19)
    at bootstrapNodeJSCore (internal/bootstrap/node.js:623:3)

[SERVER STARTER] âŒ Error: runInDockerBg process exited with 1
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (2) POST / {} -> /Il manque votre nom/ 
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ 
  âœ– (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ 
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur Rejected promise returned by test
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus Rejected promise returned by test
  â”€

  package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start

  test-partiel.js:109

   108:     const { scripts } = JSON.parse(await runInDocker('cat package.json'â€¦
   109:     t.regex(scripts.start, /node server.js/);                           
   110:   }                                                                     

  `t.regex()` must be called with a string

  Called with:

  undefined

  â€º test.serial (test-partiel.js:109:7)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur

  Rejected promise returned by test. Reason:

  Error {
    cmd: 'docker exec my-running-app sh -c "cat README.md"',
    code: 1,
    killed: false,
    signal: null,
    stderr: `cat: README.md: No such file or directoryâŠ
    `,
    stdout: '',
    message: `Command failed: docker exec my-running-app sh -c "cat README.md"âŠ
    cat: README.md: No such file or directoryâŠ
    `,
  }

  â€º cat: README.md: No such file or directory
  â€º maybeClose (internal/child_process.js:982:16)
  â€º Process.ChildProcess._handle.onexit (internal/child_process.js:259:5)



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (2) POST / {} -> /Il manque votre nom/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Il manque votre nom/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, adrien/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /Bienvenue, michelle/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  test-partiel.js:188

   187:     );                                                                  
   188:     t.is(docs.length, 1);                                    
   189:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1

  â€º test-partiel.js:188:7



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  test-partiel.js:200

   199:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   200:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   201:   }                                                                     

  Value must match expression:

  'âŒ HTTP Error: Error: socket hang up'

  Regular expression:

  /J'ai perdu la meÌmoire/

  â€º test-partiel.js:200:7

  â”€

  11 tests failed

ğŸ§¹ Stop and remove Docker containers...
