Commentaires:
- attention: MONGODB_DATABASE et MONGODB_COLLECTION ne contiennent pas un objet mais une chaine de caract√®res.
- algo: c'est l'endpoint POST qui est sens√© ins√©rer en db, pas GET.
- usage de query params au lieu du body de la requ√™te.
- usage d'une prop `from` non d√©crite dans le sujet.
- ce rendu r√©v√®le des lacunes en d√©veloppement, et un manque de pratique.

Stop and remove previous Docker containers...

üê≥ Generate and run Dockerfile from ./student-code/...

üëæ Run test suite against container...

    Lecture du code source fourni
    ‚Ñπ const express = require('express');
      const app = express();
      const PORT = process.env.PORT || 3000;
      app.use(express.json());
      app.listen(PORT, () => console.log(`Server is listening on port ${PORT}...`));




      app.post('/', function (req, res) {
          let name = req.query.nom
          if (name) {
              res.send('Bienvenue, ' + req.query.nom + '.')
          } else {
              res.send('Il manque votre nom.')
          }

      });

      const MongoClient = require('mongodb').MongoClient;
      const assert = require('assert');
      const url = process.env.MONGODB_URL || "mongodb+srv://cluster0.p62r1.mongodb.net/<partiel>";
      let collection;

      (async function () {

          try {
              const client = new MongoClient(url, {
                  useNewUrlParser: true
              });
              // Use connect method to connect to the Server
              await client.connect();
              const db = process.env.MONGODB_DATABASE || client.db("partiel");
              collection = process.env.MONGODB_COLLECTION || db.collection("nom");

          } catch (err) {
              console.log(err.stack);
          }

      })();

      app.get('/', async function (req, res) {

          // Select last name
          const lastName = await collection.find({from: nom}).sort({_id: -1}).limit(1).toArray();
          if (lastName) {
              res.send('La derni√®re personne que j\'ai rencontr√©e est: ' + lastName + '.')
          }else if (lastName === "") {
              res.send('Je n\'ai rencontr√© personne pour l\'instant')
          } else {
              res.send('J\'ai perdu la m√©moire...')
          }

          await collection.insertOne({
              from: 'nom',
              msg: req.query.msg
          });
      });


  ‚úî server.js utilise seulement await pour r√©cup√©rer les valeurs promises
  ‚úî server.js contient l'inteÃÅgraliteÃÅ du code source de votre programme
  ‚úî package.json permet d'installer les deÃÅpendances neÃÅcessaires aÃÄ l'aide de npm install
  ‚úî package.json permet de deÃÅmarrer le serveur aÃÄ l'aide de npm start
  ‚úî README.md inclue les instructions aÃÄ suivre pour installer, exeÃÅcuter et tester le serveur
(node) UnhandledPromiseRejectionWarning: ReferenceError: nom is not defined
(node) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)
  ‚úñ (1) GET / {} -> /Je n'ai rencontreÃÅ personne pour l'instant/ 
  ‚úî (2) POST / {} -> /Il manque votre nom/
(node) UnhandledPromiseRejectionWarning: ReferenceError: nom is not defined
(node) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 2)
  ‚úñ (3) GET / {} -> /Je n'ai rencontreÃÅ personne pour l'instant/ 
  ‚úñ (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
(node) UnhandledPromiseRejectionWarning: ReferenceError: nom is not defined
(node) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 3)
  ‚úñ (5) GET / {} -> /La dernieÃÄre personne que j'ai rencontreÃÅe est: adrien/ 
  ‚úñ (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
(node) UnhandledPromiseRejectionWarning: ReferenceError: nom is not defined
  ‚úñ (7) GET / {} -> /La dernieÃÄre personne que j'ai rencontreÃÅe est: michelle/ 
  ‚úñ MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
(node) UnhandledPromiseRejectionWarning: ReferenceError: nom is not defined
  ‚úñ (8) GET / -> "J'ai perdu la meÃÅmoire...", si la db ne fonctionne plus 
  ‚îÄ

  (1) GET / {} -> /Je n'ai rencontreÃÅ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '‚ùå HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /Je n'ai rencontreÃÅ personne pour l'instant/

  ‚Ä∫ test.serial (test-partiel.js:167:9)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  (3) GET / {} -> /Je n'ai rencontreÃÅ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '‚ùå HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /Je n'ai rencontreÃÅ personne pour l'instant/

  ‚Ä∫ test.serial (test-partiel.js:167:9)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'Il manque votre nom.'

  Regular expression:

  /Bienvenue, adrien/

  ‚Ä∫ test.serial (test-partiel.js:167:9)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  (5) GET / {} -> /La dernieÃÄre personne que j'ai rencontreÃÅe est: adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '‚ùå HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /La dernieÃÄre personne que j'ai rencontreÃÅe est: adrien/

  ‚Ä∫ test.serial (test-partiel.js:167:9)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  'Il manque votre nom.'

  Regular expression:

  /Bienvenue, michelle/

  ‚Ä∫ test.serial (test-partiel.js:167:9)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  (7) GET / {} -> /La dernieÃÄre personne que j'ai rencontreÃÅe est: michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  Value must match expression:

  '‚ùå HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /La dernieÃÄre personne que j'ai rencontreÃÅe est: michelle/

  ‚Ä∫ test.serial (test-partiel.js:167:9)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  test-partiel.js:188

   187:     );                                                       
   188:     t.is(docs.length, 1);                                    
   189:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1

  ‚Ä∫ test.serial (test-partiel.js:188:7)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)



  (8) GET / -> "J'ai perdu la meÃÅmoire...", si la db ne fonctionne plus

  test-partiel.js:200

   199:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/‚Ä¶
   200:     t.regex(data, /J'ai perdu la meÃÅmoire/);                            
   201:   }                                                                     

  Value must match expression:

  '‚ùå HTTP Error: Error: timeout of exceeded'

  Regular expression:

  /J'ai perdu la meÃÅmoire/

  ‚Ä∫ test.serial (test-partiel.js:200:7)
  ‚Ä∫ process._tickCallback (internal/process/next_tick.js:68:7)

  ‚îÄ

  8 tests failed

üßπ Stop and remove Docker containers...
