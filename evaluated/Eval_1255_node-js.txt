
Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./student-code/...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ const PORT = process.env.PORT || 3000;
      //require("dotenv").config();

      const express = require("express");
      const app = express();
      /*
      const MongoClient = require('mongodb').MongoClient;
      const URL = process.env.MONGODB_URL;
      const COLLECTION = process.env.MONGODB_COLLECTION;
      const DATABASE = process.env.MONGODB_DATABASE;
      */
      app.use(express.json());

      app.get("/", function (req, res) {
          res.send("Hello World");
      });

      app.post("/", async function (req, res) {

          var nom = req.query.nom

          if (nom != undefined) {
              res.send('Bienvenue, ' + nom + '.')
          } else {
              res.send('Il manque votre nom.')
          }
      });

      app.listen(PORT, function () {
          console.log("The server is listening on port", PORT);
      });
  âœ– server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises 
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ” package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install
  âœ– package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start `t.regex()` must be called with a string
  âœ” README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur
  âœ” le serveur rÃ©pond sur le port 3000
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ” (2) POST / {} -> /Il manque votre nom/
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ 
  âœ– (4) POST / "nom=adrien" -> /Bienvenue, adrien/ 
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ 
  âœ– (6) POST / "nom=michelle" -> /Bienvenue, michelle/ 
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ 
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus 

  10 tests failed

  server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:64

   63:     const { serverSource } = t.context;  
   64:     t.regex(serverSource, /await/);      
   65:     t.notRegex(serverSource, /\.then\(/);

  Value must match expression:

  `const PORT = process.env.PORT || 3000;ââŠ
  //require("dotenv").config();ââŠ
  ââŠ
  const express = require("express");ââŠ
  const app = express();ââŠ
  /*ââŠ
  const MongoClient = require('mongodb').MongoClient;ââŠ
  const URL = process.env.MONGODB_URL;ââŠ
  const COLLECTION = process.env.MONGODB_COLLECTION;ââŠ
  const DATABASE = process.env.MONGODB_DATABASE;ââŠ
  */ââŠ
  app.use(express.json());ââŠ
  ââŠ
  app.get("/", function (req, res) {ââŠ
      res.send("Hello World");ââŠ
  });ââŠ
  ââŠ
  app.post("/", async function (req, res) {ââŠ
  ââŠ
      var nom = req.query.nomââŠ
  ââŠ
      if (nom != undefined) {ââŠ
          res.send('Bienvenue, ' + nom + '.')ââŠ
      } else {ââŠ
          res.send('Il manque votre nom.')ââŠ
      }ââŠ
  });ââŠ
  ââŠ
  app.listen(PORT, function () {ââŠ
      console.log("The server is listening on port", PORT);ââŠ
  });`

  Regular expression:

  /await/



  package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:92

   91:     const { scripts } = JSON.parse(await runInDocker('cat package.json')â€¦
   92:     t.regex(scripts.start, /node server.js/);                            
   93:   }                                                                      

  `t.regex()` must be called with a string

  Called with:

  undefined



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:155

   154:       const { data } = await axios[method.toLowerCase()](url, body);
   155:       t.regex(data, exp);                                           
   156:     }                                                               

  Value must match expression:

  'Hello World'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:155

   154:       const { data } = await axios[method.toLowerCase()](url, body);
   155:       t.regex(data, exp);                                           
   156:     }                                                               

  Value must match expression:

  'Hello World'

  Regular expression:

  /Je n'ai rencontreÌ personne pour l'instant/



  (4) POST / "nom=adrien" -> /Bienvenue, adrien/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:155

   154:       const { data } = await axios[method.toLowerCase()](url, body);
   155:       t.regex(data, exp);                                           
   156:     }                                                               

  Value must match expression:

  'Il manque votre nom.'

  Regular expression:

  /Bienvenue, adrien/



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:155

   154:       const { data } = await axios[method.toLowerCase()](url, body);
   155:       t.regex(data, exp);                                           
   156:     }                                                               

  Value must match expression:

  'Hello World'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/



  (6) POST / "nom=michelle" -> /Bienvenue, michelle/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:155

   154:       const { data } = await axios[method.toLowerCase()](url, body);
   155:       t.regex(data, exp);                                           
   156:     }                                                               

  Value must match expression:

  'Il manque votre nom.'

  Regular expression:

  /Bienvenue, michelle/



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:155

   154:       const { data } = await axios[method.toLowerCase()](url, body);
   155:       t.regex(data, exp);                                           
   156:     }                                                               

  Value must match expression:

  'Hello World'

  Regular expression:

  /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:176

   175:     );                                                       
   176:     t.is(docs.length, 1);                                    
   177:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/test-partiel.js:187

   186:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   187:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   188:   }                                                                     

  Value must match expression:

  'Hello World'

  Regular expression:

  /J'ai perdu la meÌmoire/


ğŸ§¹ Stop and remove Docker containers...
