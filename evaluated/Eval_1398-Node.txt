Commentaires:
- pourquoi importer "fs" et rÃ©ponses.json ?
- l'URL, le nom et la collection de la db auraient du Ãªtre rÃ©cupÃ©rÃ©es depuis les variables d'environnement demandÃ©es.
- aucun document n'est ajoutÃ© dans la collection
- Ã  quoi sert l'appel Ã  express.json() sans app.use() ?
- le retour de l'endpoint GET ne correspond pas Ã  ce qui Ã©tait demandÃ©.

Stop and remove previous Docker containers...

ğŸ³ Generate and run Dockerfile from ./student-code/...

ğŸ‘¾ Run test suite against container...

    Lecture du code source fourni
    â„¹ const express = require("express");
      const fs = require("fs");
      const responsePath = "rÃ©ponses.json";
      const mongoUri = 'mongodb+srv://1398:1398@cluster0.nkszc.mongodb.net/<dbname>?retryWrites=true&w=majority';
      const MONGO_URL = 'mongodb+srv://1398:1398@cluster0.nkszc.mongodb.net/<dbname>?retryWrites=true&w=majority';
      const bodyParser = require('body-parser')

      const MongoClient = require("mongodb").MongoClient;

      const app = express();

      express.json()

      app.use(
        bodyParser.urlencoded({
          extended: true
        })
      );

      app.post('/', function (req, res) {
        if (req.body.nom != undefined) {
            res.send('Bienvenue, '+req.body.nom+'.') 
        } else {
            res.send('Il manque votre nom.')
        }
      });

      async function getNom() {
        const client = new MongoClient(mongoUri);

        try {
          await client.connect();
          console.log("Connected to server");
          const db = client.db("1398");
          const collection = db.collection("1398-nom");

          // RÃ©cuperer la collection nom in an array
          const response = await collection.find({}).toArray();
          return response;
        } catch (err) {
          console.log(err);
        }

        client.close();
      }

      app.get("/", async (req, res) => {
        const result = await getNom();
        res.send(result); 
      });

      const PORT = process.env.PORT || 3000;

      app.listen(PORT, () => {
        console.log(`Server listening on ${PORT}`);
      });

  âœ” server.js utilise seulement await pour rÃ©cupÃ©rer les valeurs promises
  âœ” server.js contient l'inteÌgraliteÌ du code source de votre programme
  âœ– package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install 
  âœ– package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start `t.regex()` must be called with a string
  âœ” README.md inclue les instructions aÌ€ suivre pour installer, exeÌcuter et tester le serveur
  âœ– (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ `t.regex()` must be called with a string
  âœ” (2) POST / {} -> /Il manque votre nom/
  âœ– (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/ `t.regex()` must be called with a string
  âœ” (4) POST / "nom=adrien" -> /Bienvenue, adrien/
  âœ– (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/ `t.regex()` must be called with a string
  âœ” (6) POST / "nom=michelle" -> /Bienvenue, michelle/
  âœ– (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/ `t.regex()` must be called with a string
  âœ– MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur 
  âœ– (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus `t.regex()` must be called with a string
  â”€

  package.json permet d'installer les deÌpendances neÌcessaires aÌ€ l'aide de npm install

  test-partiel.js:101

   100:     t.true(deps.includes('express'));
   101:     t.true(deps.includes('mongodb'));
   102:   }                                  

  Value is not `true`:

  false

  â€º test.serial (test-partiel.js:101:11)



  package.json permet de deÌmarrer le serveur aÌ€ l'aide de npm start

  test-partiel.js:109

   108:     const { scripts } = JSON.parse(await runInDocker('cat package.json'â€¦
   109:     t.regex(scripts.start, /node server.js/);                           
   110:   }                                                                     

  `t.regex()` must be called with a string

  Called with:

  undefined

  â€º test.serial (test-partiel.js:109:7)



  (1) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  `t.regex()` must be called with a string

  Called with:

  [
    {
      _id: '5f034e6cdd6b92d722c4ef5d',
      name: 'cc',
    },
  ]

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (3) GET / {} -> /Je n'ai rencontreÌ personne pour l'instant/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  `t.regex()` must be called with a string

  Called with:

  [
    {
      _id: '5f034e6cdd6b92d722c4ef5d',
      name: 'cc',
    },
  ]

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (5) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: adrien/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  `t.regex()` must be called with a string

  Called with:

  [
    {
      _id: '5f034e6cdd6b92d722c4ef5d',
      name: 'cc',
    },
  ]

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (7) GET / {} -> /La dernieÌ€re personne que j'ai rencontreÌe est: michelle/

  test-partiel.js:167

   166:       const { data } = await axios[method.toLowerCase()](url, body);
   167:       t.regex(data, exp);                                           
   168:     }                                                               

  `t.regex()` must be called with a string

  Called with:

  [
    {
      _id: '5f034e6cdd6b92d722c4ef5d',
      name: 'cc',
    },
  ]

  â€º test.serial (test-partiel.js:167:9)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  MONGODB_COLLECTION ne doit contenir qu'un document avec le nom du dernier visiteur

  test-partiel.js:188

   187:     );                                                       
   188:     t.is(docs.length, 1);                                    
   189:     t.deepEqual(Object.keys(docs[0]).sort(), ['_id', 'nom']);

  Difference:

  - 0
  + 1

  â€º test.serial (test-partiel.js:188:7)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)



  (8) GET / -> "J'ai perdu la meÌmoire...", si la db ne fonctionne plus

  test-partiel.js:200

   199:     const { data } = await axios.get(`http://localhost:${envVars.PORT}/â€¦
   200:     t.regex(data, /J'ai perdu la meÌmoire/);                            
   201:   }                                                                     

  `t.regex()` must be called with a string

  Called with:

  [
    {
      _id: '5f034e6cdd6b92d722c4ef5d',
      name: 'cc',
    },
  ]

  â€º test.serial (test-partiel.js:200:7)
  â€º process._tickCallback (internal/process/next_tick.js:68:7)

  â”€

  8 tests failed

ğŸ§¹ Stop and remove Docker containers...
