
Stop and remove previous Docker containers...

üê≥ Generate and run Dockerfile from ./student-code/...

üëæ Run test suite against container...

    Lecture du code source fourni
    ‚Ñπ const dotenv = require('dotenv');
      dotenv.config();
      var bodyParser = require('body-parser')
      const express = require('express');
      var fs = require('fs');

      const MongoClient = require('mongodb').MongoClient;
      const assert = require('assert');
      const app = express();

      const dbName = process.env.MONGODB_COLLECTION;

      const client = new MongoClient(process.env.MONGODB_URL, { useNewUrlParser: true });

      app.use(express.json());

      client.connect(err => {
          const db = client.db(dbName);
          const collection = db.collection(process.env.MONGODB_COLLECTION);

          //Lorsque l'utilisateur acc√®de √† la racine de l'application
          app.get('/', function (req, res) {
         
              (async function() {
                  try {
                      const user = await collection.find({}).toArray();

                      if (user) {
                          res.send("La derni√®re personne que j'ai rencontr√©e est: " + user[0].name);
                      } else {
                          res.send("Je n'ai rencontr√© personne pour l'instant");
                      }
                  } catch (err) {
                      res.send("J'ai perdu la m√©moire...");
                  }
              })();
          });

          // Lorsque nous voulons ajouter une nouvel utilisateur
          app.post('/', function (req, res) {

              const curl = req.body.name;

              if (curl) {
                  (async function() {
                      try {

                          collection.remove()
                          let addUser = await collection.insertOne({name:curl});
                          assert.equal(1, addUser.insertedCount);
                          res.send("Bienvenue, " + curl);
                      } catch (err) {
                          res.send("J'ai perdu la m√©moire...");
                      }
                  })();
              }
              else {
                  res.send("Il manque votre nom.");
              }
          });

      });

      app.listen(process.env.PORT, function () {
          console.log('Example app listening on port 3000!')
      });

  ‚úî server.js utilise seulement await pour r√©cup√©rer les valeurs promises
  ‚úî server.js contient l'inteÃÅgraliteÃÅ du code source de votre programme (358ms)
  ‚úî package.json permet d'installer les deÃÅpendances neÃÅcessaires aÃÄ l'aide de npm install (227ms)
  ‚úî package.json permet de deÃÅmarrer le serveur aÃÄ l'aide de npm start (240ms)
  ‚úî README.md inclue les instructions aÃÄ suivre pour installer, exeÃÅcuter et tester le serveur (241ms)
(node:210) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.


  Uncaught exception in test-partiel.js

  /Users/adrienjoly/dev/adrienjoly/cours-nodejs-exercise-testers/src/mongoInDocker.js:37

   36:       debug(data);                                                  
   37:       const { connectionString, pid } = JSON.parse(data.toString());
   38:       resolve({ pid, connectionString });                           

  SyntaxError: Unexpected token  in JSON at position 0

  ‚úñ test-partiel.js exited with a non-zero exit code: 1

  5 tests passed
  1 uncaught exception


üßπ Stop and remove Docker containers...
